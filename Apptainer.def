Bootstrap: docker
From: nvidia/cuda:12.4.0-base-rockylinux8

%labels
    Author YourName
    Version 1.0

%post
    # 更新系統
    dnf -y update && dnf clean all

    # 安裝必要系統套件
    dnf install -y python39 python39-pip python39-devel gcc gcc-c++ git && dnf clean all

    # 拷貝 wheel
    mkdir /wheels
    cp -r /host_wheels/* /wheels/

    # 建立 virtualenv
    python3.9 -m venv /opt/venv
    . /opt/venv/bin/activate

    # 安裝 wheel
    pip install --no-index --find-links=/wheels \
        torch-2.6.0+cu124-*.whl \
        torchvision-0.21.0+cu124-*.whl \
        torchaudio-2.6.0+cu124-*.whl \
        unsloth-2025.12.9-py3-none-any.whl \
        unsloth_zoo-2025.12.7-py3-none-any.whl \
        trl-0.22.2-py3-none-any.whl \
        accelerate-1.10.1-py3-none-any.whl \
        peft-0.17.1-py3-none-any.whl \
        bitsandbytes-0.48.2-py3-none-any.whl \
        transformers-4.56.2-py3-none-any.whl

%environment
    export PATH=/opt/venv/bin:$PATH
    export PYTHONNOUSERSITE=1
