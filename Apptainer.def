Bootstrap: docker
From: nvidia/cuda:12.4.0-base-rockylinux8

%labels
    Author YourName
    Version 1.0

%environment
    export PATH=/opt/venv/bin:$PATH
    export PYTHONNOUSERSITE=1

%post
    # 1. 安裝系統依賴
    dnf -y update && dnf clean all
    dnf install -y python39 python39-pip python39-devel gcc gcc-c++ git && dnf clean all

    # 2. 建立虛擬環境
    python3.9 -m venv /opt/venv

    # 3. 安裝 Wheels (此時 /wheels 已被掛載進來)
    # 建議直接使用路徑安裝，避免 pip 找不到檔案
    /opt/venv/bin/pip install --no-index \
        /wheels/torch-2.6.0+cu124-cp39-cp39-linux_x86_64.whl \
        /wheels/torchvision-0.21.0+cu124-cp39-cp39-linux_x86_64.whl \
        /wheels/torchaudio-2.6.0+cu124-cp39-cp39-linux_x86_64.whl \
        /wheels/unsloth-2025.12.9-py3-none-any.whl \
        /wheels/unsloth_zoo-2025.12.7-py3-none-any.whl \
        /wheels/trl-0.22.2-py3-none-any.whl \
        /wheels/accelerate-1.10.1-py3-none-any.whl \
        /wheels/peft-0.17.1-py3-none-any.whl \
        /wheels/bitsandbytes-0.48.2-py3-none-any.whl \
        /wheels/transformers-4.56.2-py3-none-any.whl

%runscript
    . /opt/venv/bin/activate
    exec "$@"